name: Next.js Build & Lint

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:
    runs-on: ubuntu-latest

    defaults:
      run:
        working-directory: ./backend

    steps:
    - uses: actions/checkout@v4

    - name: Use Node.js 20
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        cache: 'npm'
        cache-dependency-path: backend/package-lock.json

    - name: Install Dependencies
      run: npm ci

    - name: Run Linting
      run: npm run lint
      
    # We build to ensure no compilation errors (TypeScript/Next.js)
    - name: Build Project
      run: npm run build
      env:
        # Dummy vars for build time only (Encryption/DB not needed typically for pure build unless strict env check)
        # But Next.js often checks for these.
        NEON_DATABASE_URL: "postgres://mock:mock@mock:5432/mock"
        PEPPER_NEON: "mock_pepper"
        PEPPER_REDIS: "mock_pepper"
        HMAC_SECRET: "mock_hmac"
        APP_API_KEY: "mock_key"
        UPSTASH_REDIS_REST_URL: "https://mock.upstash.io"
        UPSTASH_REDIS_REST_TOKEN: "mock_token"
